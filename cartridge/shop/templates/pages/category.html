{% extends "pages/page.html" %}

{% load mezzanine_tags shop_tags i18n %}

{% block main %}{{ block.super }}

{% editable page.category.content %}
{{ page.category.content|safe }}
{% endeditable %}

{% with page.category.children.active as child_categories %}
{% if child_categories %}
<ul class="unstyled categories">
	{% for category in child_categories %}
	<li><a href="{{ category.get_absolute_url }}">{{ category.title }}</a></li>
	{% endfor %}
</ul>
{% endif %}
{% endwith %}

{% ifnotequal products.paginator.count 0 %}

<form class="product-sorting">
    <label>{% trans "Sort by" %}</label>
    <select onchange="location.href = this[this.selectedIndex].value;">
    {% for name, option in settings.SHOP_PRODUCT_SORT_OPTIONS %}
    {% with name|slugify as option_slug %}
    <option{% ifequal option_slug products.sort %} selected{% endifequal %}
        value="{{ category.get_absolute_url }}?sort={{ option_slug }}{{ querystring }}"
        >{{ name }}
    </option>
    {% endwith %}
    {% endfor %}
    </select>
</form>

<ul class="unstyled products">
    {% for product in products.object_list %}
    <li>
	    <a href="{{ product.get_absolute_url }}">
	        {% if product.image %}
	        <img src="{{ MEDIA_URL }}{% thumbnail product.image 90 90 %}"><br>
	        {% endif %}
	        {{ product }}
        </a>
        {% if product.has_price %}
            {% if product.on_sale %}
            <span class="old-price">{{ product.unit_price|currency }}</span>
            {% trans "On sale:" %}
            {% endif %}
            {{ product.price|currency }}
        {% endif %}
    </li>
    {% endfor %}
</ul>

<br clear="all">
{% pagination_for products %}

{% endifnotequal %}

{% endblock %}

